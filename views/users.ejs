<% include layout %>
<h2 class="text-center">Gestión de Usuarios</h2>

<!-- Mostrar mensaje de éxito o error -->
<% if (locals.messages && locals.messages.success) { %>
  <div class="alert alert-success text-center" role="alert">
    <% messages.success.forEach(function(message) { %>
      <%= message %><br>
    <% }) %>
  </div>
<% } %>
<% if (locals.messages && locals.messages.error) { %>
  <div class="alert alert-danger text-center" role="alert">
    <% messages.error.forEach(function(message) { %>
      <%= message %><br>
    <% }) %>
  </div>
<% } %>

<!-- Formulario para crear un nuevo usuario -->
<h3>Crear Usuario</h3>
<form action="/users" method="POST" class="needs-validation" novalidate>
  <div class="form-group">
    <label for="nombre">Nombre</label>
    <input type="text" name="nombre" class="form-control" id="nombre" placeholder="Nombre" required>
    <div class="invalid-feedback">Por favor, introduce el nombre.</div>
  </div>
  <div class="form-group">
    <label for="apellido">Apellido</label>
    <input type="text" name="apellido" class="form-control" id="apellido" placeholder="Apellido" required>
    <div class="invalid-feedback">Por favor, introduce el apellido.</div>
  </div>
  <div class="form-group">
    <label for="dni">DNI</label>
    <input type="text" name="dni" class="form-control" id="dni" placeholder="DNI" required>
    <div class="invalid-feedback">Por favor, introduce el DNI.</div>
  </div>
  <div class="form-group">
    <label for="email">Correo electrónico</label>
    <input type="email" name="email" class="form-control" id="email" placeholder="Correo electrónico" required>
    <div class="invalid-feedback">Por favor, introduce el correo electrónico.</div>
  </div>
  <div class="form-group">
    <label for="password">Contraseña</label>
    <input type="password" name="password" class="form-control" id="password" placeholder="Contraseña" required>
    <div class="invalid-feedback">Por favor, introduce la contraseña.</div>
  </div>
  <div class="form-group">
    <label for="rol">Rol</label>
    <select name="rol" class="form-control" id="rol" required>
      <option value="Administrador">Administrador</option>
      <option value="Profesor">Profesor</option>
      <option value="Alumno">Alumno</option>
    </select>
    <div class="invalid-feedback">Por favor, selecciona el rol.</div>
  </div>
  <button type="submit" class="btn btn-primary">Crear Usuario</button>
</form>

<!-- Lista de usuarios -->
<h3>Lista de Usuarios</h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Apellido</th>
      <th>DNI</th>
      <th>Email</th>
      <th>Rol</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <% users.forEach(user => { %>
      <tr>
        <td><%= user.nombre %></td>
        <td><%= user.apellido %></td>
        <td><%= user.dni %></td>
        <td><%= user.email %></td>
        <td><%= user.rol %></td>
        <td>
          <!-- Enlace para editar -->
          <a href="/users/edit/<%= user._id %>" class="btn btn-sm btn-warning">Editar</a>

          <!-- Enlace para eliminar -->
          <a href="/users/delete/<%= user._id %>" class="btn btn-sm btn-danger" onclick="return confirm('¿Estás seguro de que deseas eliminar este usuario?')">Eliminar</a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>



